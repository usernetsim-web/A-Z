<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Letter-Number Game (English Alphabet) with Voice Input</title>
<style>
  body {
    margin: 0; padding: 0;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    background: #121212;
    color: #eee;
    overflow: hidden;
    height: 100vh;
    user-select: none;
    position: relative;
  }
  h1 {
    margin: 1rem;
    text-align: center;
  }
  #prompt {
    font-size: 1.5rem;
    margin: 0 auto 1rem auto;
    text-align: center;
  }
  #feedback {
    height: 2em;
    font-size: 1.3rem;
    text-align: center;
    margin-top: 0.5rem;
  }
  #btnSpeak {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 1.5rem;
    padding: 0.5rem 1.5rem;
    border: none;
    border-radius: 8px;
    background: #0a84ff;
    color: white;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.3s ease;
    z-index: 1000;
  }
  #btnSpeak.listening {
    background: #ff3b30;
  }
  .floating {
    position: absolute;
    font-weight: 900;
    font-size: 8rem;
    user-select: none;
    pointer-events: none;
    color: #0af;
    will-change: transform, opacity;
  }
  @keyframes flyAway {
    to {
      transform: translate(var(--dx), var(--dy)) rotate(var(--dr));
      opacity: 0;
    }
  }
</style>
</head>
<body>

<h1>Letter-Number Game (English Alphabet) with Voice Input</h1>
<div id="prompt">Loading...</div>
<div id="feedback"></div>
<button id="btnSpeak">Start Recognition</button>

<audio id="shotSound" src="https://actions.google.com/sounds/v1/weapons/shotgun_fire.ogg" preload="auto"></audio>

<script>
(() => {
  const promptEl = document.getElementById('prompt');
  const feedbackEl = document.getElementById('feedback');
  const btnSpeak = document.getElementById('btnSpeak');
  const shotSound = document.getElementById('shotSound');

  // English alphabet letters A-Z
  const letters = Array.from({length:26}, (_,i) => String.fromCharCode(65 + i)); // A-Z

  // Map spoken words to numbers 1-26 (including digits and words)
  // Include common English number words up to 26
  const numberWords = {
    'ONE':1,'TWO':2,'TO':2,'TOO':2,'THREE':3,'FOUR':4,'FOR':4,'FIVE':5,'SIX':6,'SEVEN':7,'EIGHT':8,'ATE':8,'NINE':9,'TEN':10,
    'ELEVEN':11,'TWELVE':12,'THIRTEEN':13,'FOURTEEN':14,'FIFTEEN':15,'SIXTEEN':16,'SEVENTEEN':17,'EIGHTEEN':18,'NINETEEN':19,
    'TWENTY':20,'TWENTY ONE':21,'TWENTY-ONE':21,'TWENTY TWO':22,'TWENTY-TWO':22,'TWENTY THREE':23,'TWENTY-THREE':23,
    'TWENTY FOUR':24,'TWENTY-FOUR':24,'TWENTY FIVE':25,'TWENTY-FIVE':25,'TWENTY SIX':26,'TWENTY-SIX':26,
  };

  // We'll parse recognized text to extract numbers or letters
  // Normalize text to uppercase and trim
  function parseAnswer(text) {
    text = text.trim().toUpperCase();

    // Try direct letter A-Z
    if (text.length === 1 && letters.includes(text)) return {type:'letter', value: text};

    // Try number as digit string
    if (/^\d+$/.test(text)) {
      const num = parseInt(text,10);
      if (num >= 1 && num <= 26) return {type:'number', value: num};
    }
    // Try number words (some with spaces or hyphens)
    // Replace hyphens with spaces
    const cleaned = text.replace(/-/g, ' ');
    if (numberWords.hasOwnProperty(cleaned)) {
      return {type:'number', value: numberWords[cleaned]};
    }
    // Sometimes recognition returns multiple words, try to match first or all
    // For example "twenty one" or "twenty one something"
    // We'll try to find a number word prefix:
    for (const key in numberWords) {
      if (cleaned.startsWith(key)) {
        return {type:'number', value: numberWords[key]};
      }
    }
    // If single letter spelled out as word ("bee" â†’ B), we can add a map for common letter names:
    const letterNames = {
      'A': 'A',
      'B': 'B','BEE':'B','BE':'B',
      'C': 'C','SEE':'C','SEA':'C',
      'D': 'D','DEE':'D',
      'E': 'E','EE':'E',
      'F': 'F','EF':'F',
      'G': 'G','GEE':'G',
      'H': 'H','ACH':'H','AYCH':'H',
      'I': 'I','EYE':'I',
      'J': 'J','JAY':'J',
      'K': 'K','KAY':'K',
      'L': 'L','EL':'L',
      'M': 'M','EM':'M',
      'N': 'N','EN':'N',
      'O': 'O','OH':'O',
      'P': 'P','PEE':'P','PE':'P',
      'Q': 'Q','QUEUE':'Q','CUE':'Q',
      'R': 'R','AR':'R',
      'S': 'S','ESS':'S',
      'T': 'T','TEE':'T',
      'U': 'U','YOU':'U','YOO':'U',
      'V': 'V','VEE':'V',
      'W': 'W','DOUBLE YOU':'W','DOUBLE-U':'W',
      'X': 'X','EX':'X',
      'Y': 'Y','WHY':'Y',
      'Z': 'Z','ZED':'Z','ZEE':'Z',
    };
    if (letterNames.hasOwnProperty(text)) return {type:'letter', value: letterNames[text]};

    return null;
  }

  // SpeechRecognition setup
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!SpeechRecognition) {
    alert('Your browser does not support Speech Recognition. Use Chrome or Edge.');
    btnSpeak.disabled = true;
    promptEl.textContent = 'Speech Recognition not supported.';
    return;
  }
  const recognition = new SpeechRecognition();
  recognition.lang = 'en-US';
  recognition.interimResults = false;
  recognition.maxAlternatives = 1;
  recognition.continuous = true;

  // Shuffle Fisher-Yates
  function shuffle(array) {
    let currentIndex = array.length, randomIndex;
    while (currentIndex !== 0) {
      randomIndex = Math.floor(Math.random() * currentIndex);
      currentIndex--;
      [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
    }
    return array;
  }

  let shuffledIndexes = [];
  let currentRound = 0;
  let step = 0; // 0: show letter, expect number; 1: show number, expect letter

  function resetGameOrder() {
    shuffledIndexes = shuffle([...Array(letters.length).keys()]);
    currentRound = 0;
  }

  function showFloating(text) {
    const floatEl = document.createElement('div');
    floatEl.className = 'floating';
    floatEl.textContent = text;

    const pad = 120;
    const vw = window.innerWidth;
    const vh = window.innerHeight;
    const x = Math.random() * (vw - pad*2) + pad;
    const y = Math.random() * (vh - pad*2) + pad;

    floatEl.style.left = `${x}px`;
    floatEl.style.top = `${y}px`;

    document.body.appendChild(floatEl);

    return floatEl;
  }

  function animateFlyAway(el) {
    const dx = (Math.random() - 0.5) * 400 + 'px';
    const dy = (Math.random() - 0.5) * 400 + 'px';
    const dr = (Math.random() - 0.5) * 720 + 'deg';

    el.style.setProperty('--dx', dx);
    el.style.setProperty('--dy', dy);
    el.style.setProperty('--dr', dr);

    el.style.animation = 'flyAway 1.2s forwards ease-out';

    el.addEventListener('animationend', () => {
      if (el.parentNode) el.parentNode.removeChild(el);
    });
  }

  function playShot() {
    shotSound.currentTime = 0;
    shotSound.play();
  }

  let currentFloatingEl = null;

  function showCurrent() {
    if (currentFloatingEl) {
      currentFloatingEl.remove();
      currentFloatingEl = null;
    }
    if (currentRound >= shuffledIndexes.length) {
      promptEl.textContent = 'Game completed! Restarting...';
      feedbackEl.textContent = '';
      setTimeout(() => {
        resetGameOrder();
        step = 0;
        showCurrent();
      }, 3000);
      return;
    }
    const idx = shuffledIndexes[currentRound];
    if (step === 0) {
      promptEl.textContent = "Name the position number of the letter shown (1 to 26)";
      currentFloatingEl = showFloating(letters[idx]);
    } else {
      promptEl.textContent = "Name the letter corresponding to the number shown";
      currentFloatingEl = showFloating((idx + 1).toString());
    }
  }

  recognition.onresult = (event) => {
    const transcript = event.results[event.results.length - 1][0].transcript;
    const parsed = parseAnswer(transcript);

    if (!parsed) {
      feedbackEl.textContent = `Not recognized: "${transcript.trim()}"`;
      return;
    }

    const idx = shuffledIndexes[currentRound];
    if (step === 0 && parsed.type === 'number') {
      if (parsed.value === idx + 1) {
        feedbackEl.textContent = `Correct! Letter ${letters[idx]} is number ${parsed.value}`;
        playShot();
        animateFlyAway(currentFloatingEl);
        currentFloatingEl = null;
        step = 1;
      } else {
        feedbackEl.textContent = `Wrong number "${parsed.value}". Try again.`;
      }
    } else if (step === 1 && parsed.type === 'letter') {
      if (parsed.value === letters[idx]) {
        feedbackEl.textContent = `Correct! Number ${idx+1} is letter ${parsed.value}`;
        playShot();
        animateFlyAway(currentFloatingEl);
        currentFloatingEl = null;
        currentRound++;
        step = 0;
      } else {
        feedbackEl.textContent = `Wrong letter "${parsed.value}". Try again.`;
      }
    } else {
      feedbackEl.textContent = `Expected ${step === 0 ? 'number' : 'letter'}, but got ${parsed.type}. Try again.`;
    }

    // Show next prompt if step changed or round advanced
    if (!currentFloatingEl) {
      setTimeout(() => {
        showCurrent();
      }, 1300);
    }
  };

  recognition.onerror = (e) => {
    feedbackEl.textContent = 'Error in recognition: ' + e.error;
  };
  recognition.onend = () => {
    if (btnSpeak.classList.contains('listening')) {
      recognition.start(); // restart recognition for continuous listening
    }
  };

  btnSpeak.addEventListener('click', () => {
    if (btnSpeak.classList.contains('listening')) {
      recognition.stop();
      btnSpeak.classList.remove('listening');
      btnSpeak.textContent = 'Start Recognition';
      promptEl.textContent = 'Recognition stopped.';
    } else {
      recognition.start();
      btnSpeak.classList.add('listening');
      btnSpeak.textContent = 'Stop Recognition';
      feedbackEl.textContent = '';
      if (!currentFloatingEl) showCurrent();
    }
  });

  resetGameOrder();
  promptEl.textContent = 'Press "Start Recognition" and say answers clearly.';
})();
</script>

</body>
</html>
