<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Игра: буква ↔ номер с голосовым вводом (русский и английский)</title>
<style>
  body {
    margin: 0; padding: 0;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    background: #121212;
    color: #eee;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    user-select: none;
    text-align: center;
  }
  h1 {
    margin-bottom: 1rem;
  }
  #display {
    font-size: 8rem;
    font-weight: 900;
    margin: 2rem 0;
    user-select: none;
  }
  #prompt {
    font-size: 1.5rem;
    margin-bottom: 1rem;
    min-height: 2em;
  }
  #btnSpeak {
    font-size: 1.5rem;
    padding: 0.5rem 1.5rem;
    border: none;
    border-radius: 8px;
    background: #0a84ff;
    color: white;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.3s ease;
    margin-top: 1rem;
  }
  #btnSpeak.listening {
    background: #ff3b30;
  }
  #feedback {
    margin-top: 1rem;
    height: 2em;
    font-size: 1.3rem;
  }
</style>
</head>
<body>

<h1>Игра: буква ↔ номер с голосовым вводом (русский и английский)</h1>
<div id="display">A</div>
<div id="prompt">Назовите порядковый номер буквы</div>
<button id="btnSpeak">Говорить</button>
<div id="feedback"></div>

<audio id="shotSound" src="https://actions.google.com/sounds/v1/weapons/shotgun_fire.ogg" preload="auto"></audio>

<script>
(() => {
  const displayEl = document.getElementById('display');
  const promptEl = document.getElementById('prompt');
  const btnSpeak = document.getElementById('btnSpeak');
  const feedbackEl = document.getElementById('feedback');
  const shotSound = document.getElementById('shotSound');

  const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
  let step = 0; // 0 - показываем букву, ждем номер; 1 - показываем номер, ждем букву
  let currentIndex = 0;

  // Сопоставление русских и английских слов для чисел 1..26
  // Чтобы распознанный текст можно было конвертировать в число
  const numberMap = {
    'ONE':1, 'TWO':2, 'THREE':3, 'FOUR':4, 'FIVE':5, 'SIX':6, 'SEVEN':7, 'EIGHT':8, 'NINE':9, 'TEN':10,
    'ELEVEN':11, 'TWELVE':12, 'THIRTEEN':13, 'FOURTEEN':14, 'FIFTEEN':15, 'SIXTEEN':16, 'SEVENTEEN':17,
    'EIGHTEEN':18, 'NINETEEN':19, 'TWENTY':20, 'TWENTYONE':21, 'TWENTYTWO':22, 'TWENTYTHREE':23,
    'TWENTYFOUR':24, 'TWENTYFIVE':25, 'TWENTYSIX':26,
    '1':1,'2':2,'3':3,'4':4,'5':5,'6':6,'7':7,'8':8,'9':9,'10':10,'11':11,'12':12,'13':13,'14':14,'15':15,'16':16,'17':17,'18':18,'19':19,'20':20,'21':21,'22':22,'23':23,'24':24,'25':25,'26':26,
    // Русские слова:
    'ОДИН':1, 'ДВА':2, 'ТРИ':3, 'ЧЕТЫРЕ':4, 'ПЯТЬ':5, 'ШЕСТЬ':6, 'СЕМЬ':7, 'ВОСЕМЬ':8, 'ВОСЕМЬЬ':8, 'ВОСЕМ':8,
    'ДЕВЯТЬ':9, 'ДЕВЯТ':9, 'ДЕСЯТЬ':10, 'ОДИННАДЦАТЬ':11, 'ДВЕНАДЦАТЬ':12, 'ТРИНАДЦАТЬ':13, 'ЧЕТЫРНАДЦАТЬ':14,
    'ПЯТНАДЦАТЬ':15, 'ШЕСТНАДЦАТЬ':16, 'СЕМНАДЦАТЬ':17, 'ВОСЕМНАДЦАТЬ':18, 'ДЕВЯТНАДЦАТЬ':19, 'ДВАДЦАТЬ':20,
    'ДВАДЦАТЬОДИН':21, 'ДВАДЦАТЬ ДВА':22, 'ДВАДЦАТЬТРИ':23, 'ДВАДЦАТЬ ЧЕТЫРЕ':24, 'ДВАДЦАТЬПЯТЬ':25, 'ДВАДЦАТЬ ШЕСТЬ':26
  };

  // Для букв — допускаем произношение по-английски и по-русски (А=ЭЙ, Б=БИ, С=СИ и т.п.)
  // Но проще пока принимать только английские буквы (A-Z).
  // Можно добавить поддержку русских названий букв, но это сложнее.
  // В распознавании речи лучше произносить букву по-английски.

  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!SpeechRecognition) {
    alert('Ваш браузер не поддерживает распознавание речи. Используйте Chrome или Edge.');
    btnSpeak.disabled = true;
    return;
  }
  const recognition = new SpeechRecognition();
  recognition.lang = 'ru-RU'; // Русский язык для распознавания
  recognition.interimResults = false;
  recognition.maxAlternatives = 1;

  function playShot() {
    shotSound.currentTime = 0;
    shotSound.play();
  }

  function nextRound() {
    currentIndex = Math.floor(Math.random() * letters.length);
    step = 0;
    displayEl.textContent = letters[currentIndex];
    promptEl.textContent = "Назовите порядковый номер буквы (от 1 до 26)";
    feedbackEl.textContent = "";
  }

  function switchStep() {
    if (step === 0) {
      step = 1;
      displayEl.textContent = (currentIndex + 1).toString();
      promptEl.textContent = "Назовите букву с этим порядковым номером (произносите английскую букву)";
      feedbackEl.textContent = "";
    } else {
      nextRound();
    }
  }

  // Нормализация и попытка получить число из распознанного текста
  function parseNumber(text) {
    let t = text.toUpperCase().replace(/\s+/g, '');
    if (numberMap[t] !== undefined) return numberMap[t];
    // Попытка извлечь число из текста (например, "два" или "2")
    let digits = t.match(/\d+/);
    if (digits) return Number(digits[0]);
    return null;
  }

  // Нормализация буквы: берем первый символ A-Z
  function parseLetter(text) {
    let t = text.toUpperCase().trim();
    // Возьмем первый символ латинской буквы
    let m = t.match(/[A-Z]/);
    if (m) return m[0];
    // Если нет латинской буквы, попробуем русские названия букв (очень упрощенно)
    // Например, "эй" -> A, "би" -> B, "си" -> C, "ди" -> D, "и" -> I и т.д.
    const ruToEn = {
      'ЭЙ':'A', 'БИ':'B', 'СИ':'C', 'ДИ':'D', 'И':'E', 'ФИ':'F', 'ДЖИ':'G', 'ЭЙЧ':'H', 'АЙ':'I',
      'ДЖЕЙ':'J', 'КЕЙ':'K', 'ЭЛ':'L', 'ЭМ':'M', 'ЭН':'N', 'ОУ':'O', 'ПИ':'P', 'КЬЮ':'Q', 'АР':'R',
      'ЭС':'S', 'ТИ':'T', 'Ю':'U', 'ВИ':'V', 'ДАБЛЬЮ':'W', 'ЭКС':'X', 'УАЙ':'Y', 'ЗИ':'Z'
    };
    for (let ruName in ruToEn) {
      if (t.includes(ruName)) return ruToEn[ruName];
    }
    return null;
  }

  recognition.addEventListener('result', e => {
    const speechResult = e.results[0][0].transcript;
    if (step === 0) {
      // Ждем номер
      let num = parseNumber(speechResult);
      if (num === currentIndex + 1) {
        playShot();
        feedbackEl.textContent = `Верно! Буква "${letters[currentIndex]}" — это номер ${num}`;
        setTimeout(switchStep, 1200);
      } else {
        feedbackEl.textContent = `Неверно. Вы сказали: "${speechResult}". Попробуйте ещё раз.`;
      }
    } else {
      // Ждем букву
      let letter = parseLetter(speechResult);
      if (letter === letters[currentIndex]) {
        playShot();
        feedbackEl.textContent = `Верно! Номер ${currentIndex + 1} — это буква "${letters[currentIndex]}"`;
        setTimeout(switchStep, 1200);
      } else {
        feedbackEl.textContent = `Неверно. Вы сказали: "${speechResult}". Попробуйте ещё раз.`;
      }
    }
  });

  recognition.addEventListener('error', e => {
    feedbackEl.textContent = `Ошибка распознавания речи: ${e.error}`;
  });

  recognition.addEventListener('end', () => {
    btnSpeak.classList.remove('listening');
    btnSpeak.textContent = "Говорить";
  });

  btnSpeak.addEventListener('click', () => {
    if (btnSpeak.classList.contains('listening')) {
      recognition.stop();
      btnSpeak.classList.remove('listening');
      btnSpeak.textContent = "Говорить";
    } else {
      feedbackEl.textContent = "Слушаю...";
      recognition.start();
      btnSpeak.classList.add('listening');
      btnSpeak.textContent = "Говорите...";
    }
  });

  nextRound();
})();
</script>

</body>
</html>
